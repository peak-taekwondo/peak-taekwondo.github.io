!function(){"use strict";function e(e,t){if(!e)throw new Error(function n(e,t){return t?`${e} -- ${t}`:e}(`Assertion failed: ${e} is not truthy`,t))}const t=[],n=["January","February","March","April","May","June","July","August","September","October","November","December"];function o(e){const t=new Date(e);return`${t.getDate()} ${n[t.getMonth()]} ${t.getFullYear()}`}class s{constructor(t){this.tableContainer=t;const n=t.querySelector("table");e(n,`Unable to locate expected announcment table for ${t.id}`);let o=n.querySelector("tbody");o||(o=n),this.tableBody=o}addAnnouncement(e){const t=document.createElement("tr"),n=document.createElement("td");n.classList.add("issue-date"),n.innerText=o(e.creationDate);const s=document.createElement("td");s.classList.add("announcement"),s.innerText=e.content,t.appendChild(n),t.appendChild(s),this.tableBody.appendChild(t),this.tableContainer.classList.remove("empty")}}function c(e){let t=0;const n=e.content;for(let e=0;e<n.length;e++)t=(t<<5)-t+n.charCodeAt(e),t|=0;return`peak.announcement.ids.${e.creationDate}-${t}-${e.endDate}`}const i=/peak\.announcment\.ids\.\d+-\d+-\d+/;function a(t){e(i.test(t),`${t} does not appear to be an Announcment ID`);const n=t.split("-").pop(),o=Number.parseInt(n);return new Date(o)}const r=new Map;function l(e){return r.has(e)||r.set(e,new e),r.get(e)}function d(e=0){return new Promise(t=>{setTimeout(t,e)})}var u=function(e,t,n,o){return new(n||(n=Promise))((function(s,c){function i(e){try{r(o.next(e))}catch(e){c(e)}}function a(e){try{r(o.throw(e))}catch(e){c(e)}}function r(e){e.done?s(e.value):function t(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(i,a)}r((o=o.apply(e,t||[])).next())}))};class m{constructor(e){this.announcement=e,this.element=document.createElement("div"),this.element.classList.add("butter-bar"),this.element.classList.add("card");const t=document.createElement("div");t.classList.add("message"),t.innerHTML=`<b>${o(e.creationDate)}:</b> ${e.content}`;const n=document.createElement("div");n.classList.add("close"),n.tabIndex=-1;const s=document.createElement("img");s.src="resources/close-icon.png",n.appendChild(s),this.element.appendChild(t),this.element.appendChild(n),this.closeElement=n,document.body.appendChild(this.element)}show(){return u(this,void 0,void 0,(function*(){const e=document.documentElement.clientHeight;this.element.style.top=`${e}px`,yield d(0),this.element.classList.add("animate"),yield d(0),this.element.style.top=`${e-20-this.element.clientHeight}px`}))}addOnClose(e){this.closeElement.onclick=e}close(){document.body.removeChild(this.element),window.localStorage.setItem(c(this.announcement),"viewed")}}class h{constructor(){if(this.announcements=[],"undefined"!=typeof Storage){const e=[],t=new Date,n=window.localStorage;for(let o=0;o<n.length;o++){const s=n.key(o);i.test(s)&&a(s)<t&&e.push(s)}for(const t of e)n.remove(t)}}manageAnnouncement(e){if("undefined"==typeof Storage)return;if("viewed"===window.localStorage.getItem(c(e)))return;const t=new m(e);t.addOnClose(()=>{this.closeCurrent()}),this.announcements.push(t),d(0).then(()=>{this.updateDisplay()})}closeCurrent(){this.showing&&(this.showing.close(),this.showing=void 0),d(0).then(()=>{this.updateDisplay()})}updateDisplay(){this.showing||(this.showing=this.announcements.pop(),this.showing&&this.showing.show())}static getInstance(){return l(h)}}function p(e,t){return t.creationDate-e.creationDate}function f(e,t){const n=document.getElementById(e);if(n){const e=new s(n);for(const n of t)e.addAnnouncement(n)}}class w{constructor(){}load(){const e=Date.now(),n=[],o=[];for(const s of t)s.endDate<e?o.push(s):(!s.startDate||s.startDate<=e)&&n.push(s);n.sort(p),o.sort(p),f("live",n),f("expired",o);for(const e of n)h.getInstance().manageAnnouncement(e)}static getInstance(){return l(w)}}!function y(t,n){e(t,"Symbol name must not be empty."),e(n,"Symbol must be defined.");let o=window;const s=t.split(".");for(const e of s.slice(0,-1))o[e]||(o[e]={}),o=o[e];const c=s.pop();e(!o[c],`Symbol ${t} already defined`),o[c]=n}("peak.loadAnnouncements",(function g(){w.getInstance().load()}))}();
//# sourceMappingURL=peak_compiled.js.map